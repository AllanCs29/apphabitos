<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#c084fc">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mi Vida Productiva">
    <meta name="description" content="Aplicaci√≥n para gestionar tu vida productiva: trabajo, metas, ejercicio, nutrici√≥n y m√°s">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <title>Mi Vida Productiva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom right, #faf5ff, #fce7f3);
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 1024px;
            margin: 0 auto;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(to right, #c084fc, #f0abfc);
            padding: 1.5rem;
            color: white;
            text-align: center;
        }
        .header h1 {
            font-size: 1.875rem;
            font-weight: bold;
        }
        .tabs {
            display: flex;
            overflow-x: auto;
            background: #f3e8ff;
            border-bottom: 1px solid #e9d5ff;
        }
        .tab-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            white-space: nowrap;
            border: none;
            background: transparent;
            color: #4b5563;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        .tab-button:hover {
            background: #faf5ff;
        }
        .tab-button.active {
            background: white;
            color: #9333ea;
            border-bottom-color: #9333ea;
        }
        .content {
            padding: 1.5rem;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9333ea;
            margin-bottom: 1rem;
        }
        h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        input[type="text"], input[type="number"], input[type="datetime-local"], textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9d5ff;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus {
            border-color: #c084fc;
        }
        button {
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        button:hover {
            transform: translateY(-1px);
        }
        .btn-primary {
            background: #9333ea;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #faf5ff;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }
        .card {
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        .card-blue {
            background: linear-gradient(to bottom right, #dbeafe, #bfdbfe);
        }
        .card-orange {
            background: linear-gradient(to bottom right, #fed7aa, #fdba74);
        }
        .card-pink {
            background: linear-gradient(to bottom right, #fbcfe8, #f9a8d4);
        }
        .card-green {
            background: linear-gradient(to bottom right, #ecfdf5, #d1fae5);
        }
        .card-purple {
            background: linear-gradient(to bottom right, #faf5ff, #fce7f3);
        }
        input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
            margin-right: 0.75rem;
        }
        .progress-bar-container {
            background: #e5e7eb;
            border-radius: 9999px;
            height: 1rem;
            overflow: hidden;
        }
        .progress-bar {
            background: #059669;
            height: 100%;
            transition: width 0.5s ease;
        }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .text-center { text-align: center; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mi Vida Productiva</h1>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="trabajo">üìÖ Trabajo</button>
            <button class="tab-button" data-tab="metas">üéØ Metas</button>
            <button class="tab-button" data-tab="ejercicio">üí™ Ejercicio</button>
            <button class="tab-button" data-tab="nutricion">üçΩÔ∏è Nutrici√≥n</button>
            <button class="tab-button" data-tab="sueno">üåô Sue√±o</button>
            <button class="tab-button" data-tab="ahorro">üíµ Ahorro</button>
            <button class="tab-button" data-tab="otros">üìö Otros</button>
        </div>

        <div class="content">
            <!-- Trabajo -->
            <div id="tab-trabajo" class="tab-content active">
                <h2>Actividades Laborales</h2>
                <input type="text" id="work-input" placeholder="Nueva actividad laboral" class="mb-2">
                <div id="work-list"></div>
            </div>

            <!-- Metas -->
            <div id="tab-metas" class="tab-content">
                <h2>Metas y H√°bitos</h2>
                <div class="mb-3">
                    <h3>H√°bitos Diarios</h3>
                    <input type="text" id="goal-input" placeholder="Nuevo h√°bito" class="mb-1">
                    <div id="goals-list"></div>
                </div>
                <div>
                    <h3>Tareas con Recordatorio</h3>
                    <input type="text" id="task-input" placeholder="Nueva tarea" class="mb-1">
                    <div class="flex gap-1 mb-2">
                        <input type="datetime-local" id="task-datetime" style="flex: 1;">
                        <button class="btn-primary" onclick="addTask()">‚ûï</button>
                    </div>
                    <div id="tasks-list"></div>
                </div>
            </div>

            <!-- Ejercicio -->
            <div id="tab-ejercicio" class="tab-content">
                <h2>Rutina de Ejercicio</h2>
                <div class="card card-purple mb-3">
                    <h3 id="today-routine">Hoy: Calculando...</h3>
                </div>
                <div class="grid-2 mb-3">
                    <div class="card" style="background: #faf5ff;">
                        <label style="display: block; margin-bottom: 0.5rem;">Altura (cm)</label>
                        <input type="number" id="height-input" value="170">
                    </div>
                    <div class="card" style="background: #fce7f3;">
                        <label style="display: block; margin-bottom: 0.5rem;">Peso (kg)</label>
                        <input type="number" id="weight-input" value="70">
                    </div>
                </div>
                <input type="text" id="custom-exercise-input" placeholder="Agregar ejercicio personalizado" class="mb-2">
                <div id="exercises-list"></div>
            </div>

            <!-- Nutrici√≥n -->
            <div id="tab-nutricion" class="tab-content">
                <h2>Nutrici√≥n y Macros</h2>
                <div class="grid-2 mb-3">
                    <div class="card" style="background: #faf5ff; grid-column: span 2;">
                        <label style="display: block; margin-bottom: 0.5rem;">Meta de Calor√≠as</label>
                        <input type="number" id="calories-goal" value="2000">
                    </div>
                    <div class="card" style="background: #dbeafe;">
                        <label style="display: block; margin-bottom: 0.5rem;">Prote√≠na (g)</label>
                        <input type="number" id="protein-goal" value="150">
                    </div>
                    <div class="card" style="background: #dcfce7;">
                        <label style="display: block; margin-bottom: 0.5rem;">Carbohidratos (g)</label>
                        <input type="number" id="carbs-goal" value="200">
                    </div>
                    <div class="card" style="background: #fef9c3; grid-column: span 2;">
                        <label style="display: block; margin-bottom: 0.5rem;">Grasas (g)</label>
                        <input type="number" id="fat-goal" value="60">
                    </div>
                </div>
                <div class="card card-purple mb-3">
                    <h3 class="text-center">Progreso Diario</h3>
                    <div class="text-center mb-2">
                        <div id="consumed-calories" style="font-size: 3rem; font-weight: bold; color: #9333ea;">0</div>
                        <div style="color: #4b5563;">de <span id="goal-calories-display">2000</span> kcal</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">Restantes: <span id="remaining-calories">2000</span> kcal</div>
                    </div>
                    <div class="grid-3 text-center">
                        <div>
                            <div id="consumed-protein" style="font-size: 1.5rem; font-weight: bold; color: #2563eb;">0</div>
                            <div style="font-size: 0.875rem;">Prote√≠na</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Meta: <span id="goal-protein-display">150</span>g</div>
                        </div>
                        <div>
                            <div id="consumed-carbs" style="font-size: 1.5rem; font-weight: bold; color: #16a34a;">0</div>
                            <div style="font-size: 0.875rem;">Carbos</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Meta: <span id="goal-carbs-display">200</span>g</div>
                        </div>
                        <div>
                            <div id="consumed-fat" style="font-size: 1.5rem; font-weight: bold; color: #ca8a04;">0</div>
                            <div style="font-size: 0.875rem;">Grasas</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Meta: <span id="goal-fat-display">60</span>g</div>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <h3>Registrar Comida</h3>
                    <div class="grid-5 mb-1">
                        <input type="text" id="food-name" placeholder="Alimento">
                        <input type="number" id="food-calories" placeholder="Cal">
                        <input type="number" id="food-protein" placeholder="Prot">
                        <input type="number" id="food-carbs" placeholder="Carbs">
                        <input type="number" id="food-fat" placeholder="Gras">
                    </div>
                    <button class="btn-primary" style="width: 100%;" onclick="addMeal()">Agregar Comida</button>
                </div>
                <div id="meals-list"></div>
            </div>

            <!-- Sue√±o -->
            <div id="tab-sueno" class="tab-content">
                <h2>Registro de Sue√±o</h2>
                <div id="sleep-evaluation" class="card mb-3" style="background: #f3f4f6;">
                    <h3>Calidad del Sue√±o: Sin datos</h3>
                    <p>Registra tus horas de sue√±o</p>
                </div>
                <div class="mb-2">
                    <label style="display: block; margin-bottom: 0.5rem;">Horas dormidas</label>
                    <input type="number" step="0.5" id="sleep-hours" placeholder="Ej: 7.5" class="mb-1">
                    <button class="btn-primary" style="width: 100%;" onclick="addSleepLog()">Registrar Sue√±o</button>
                </div>
                <div id="sleep-logs-list"></div>
            </div>

            <!-- Ahorro -->
            <div id="tab-ahorro" class="tab-content">
                <h2>Ahorro</h2>
                <div class="card card-green mb-3">
                    <h3 style="color: #4b5563;">Meta de Ahorro</h3>
                    <div style="font-size: 3.75rem; font-weight: bold; color: #059669; margin-bottom: 1rem;">$<span id="savings-goal-display">10,000</span></div>
                    <input type="number" id="savings-goal-input" value="10000" class="mb-2">
                    <div style="padding-top: 1.5rem; border-top: 2px solid #6ee7b7;">
                        <div class="grid-2 text-center mb-2">
                            <div>
                                <div style="font-size: 1.875rem; font-weight: bold; color: #059669;">$<span id="current-savings">0</span></div>
                                <div style="font-size: 0.875rem; color: #4b5563;">Ahorrado</div>
                            </div>
                            <div>
                                <div style="font-size: 1.875rem; font-weight: bold; color: #ea580c;">$<span id="remaining-savings">10,000</span></div>
                                <div style="font-size: 0.875rem; color: #4b5563;">Faltante</div>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div id="savings-progress-bar" class="progress-bar" style="width: 0%;"></div>
                        </div>
                        <p class="text-center" style="font-size: 0.875rem; color: #4b5563; margin-top: 0.5rem;"><span id="savings-percentage">0</span>% completado</p>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 0.5rem;">Agregar ahorro</label>
                    <input type="number" id="savings-amount" placeholder="Cantidad" class="mb-1">
                    <button class="btn-primary" style="width: 100%; background: #059669;" onclick="addSavings()">Agregar al Ahorro</button>
                </div>
            </div>

            <!-- Otros -->
            <div id="tab-otros" class="tab-content">
                <h2>Otros Registros</h2>
                <div class="grid-3 mb-3" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                    <div class="card card-blue">
                        <h3>NoFap</h3>
                        <div id="nofap-days" style="font-size: 3rem; font-weight: bold; color: #2563eb; margin-bottom: 0.5rem;">0</div>
                        <div style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0.75rem;">d√≠as</div>
                        <div class="flex gap-1">
                            <button class="btn-primary" style="flex: 1; background: #2563eb;" onclick="incrementNoFap()">‚ûï</button>
                            <button class="btn-danger" onclick="resetNoFap()">Reset</button>
                        </div>
                    </div>
                    <div class="card card-orange">
                        <h3>P√°ginas Le√≠das</h3>
                        <div id="pages-read" style="font-size: 3rem; font-weight: bold; color: #ea580c; margin-bottom: 0.5rem;">0</div>
                        <div style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0.75rem;">p√°ginas</div>
                        <div class="flex gap-1">
                            <button class="btn-primary" style="flex: 1; background: #ea580c;" onclick="incrementPages()">‚ûï</button>
                            <button class="btn-danger" onclick="resetPages()">Reset</button>
                        </div>
                    </div>
                    <div class="card card-pink">
                        <h3>Pomodoro</h3>
                        <div id="pomodoro-timer" style="font-size: 3rem; font-weight: bold; color: #db2777; margin-bottom: 0.5rem;">25:00</div>
                        <div style="font-size: 0.875rem; color: #4b5563; margin-bottom: 0.75rem;">minutos</div>
                        <div class="flex gap-1">
                            <button id="pomodoro-toggle" class="btn-primary" style="flex: 1; background: #db2777;" onclick="togglePomodoro()">Iniciar</button>
                            <button class="btn-secondary" onclick="resetPomodoro()">Reset</button>
                        </div>
                    </div>
                </div>
                <div class="card card-purple">
                    <h3>üì• Generar Reportes</h3>
                    <p style="color: #4b5563; margin-bottom: 1rem;">Descarga reportes detallados con gr√°ficas y an√°lisis Pareto 80/20</p>
                    <div class="flex gap-1">
                        <button class="btn-primary" style="flex: 1;" onclick="generateReport('semanal')">Reporte Semanal</button>
                        <button class="btn-primary" style="flex: 1; background: #6366f1;" onclick="generateReport('mensual')">Reporte Mensual</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data
        let data = {
            workActivities: [],
            goals: [],
            tasks: [],
            exercises: [],
            customExercises: [],
            meals: [],
            sleepLogs: [],
            noFapDays: 0,
            pagesRead: 0,
            pomodoroTime: 1500,
            pomodoroRunning: false,
            currentSavings: 0,
            height: 170,
            weight: 70
        };

        const exerciseRoutine = [
            { day: 1, focus: 'Pecho y Tr√≠ceps', exercises: ['Press de banca', 'Press inclinado', 'Aperturas', 'Fondos', 'Extensiones de tr√≠ceps'] },
            { day: 2, focus: 'Espalda y B√≠ceps', exercises: ['Dominadas', 'Remo con barra', 'Jal√≥n al pecho', 'Remo con mancuerna', 'Curl con barra'] },
            { day: 3, focus: 'Piernas', exercises: ['Sentadillas', 'Prensa', 'Peso muerto rumano', 'Extensiones', 'Curl femoral'] },
            { day: 4, focus: 'Hombros y Abdomen', exercises: ['Press militar', 'Elevaciones laterales', 'Elevaciones frontales', 'P√°jaros', 'Plancha'] },
            { day: 5, focus: 'Full Body', exercises: ['Peso muerto', 'Press de banca', 'Sentadillas', 'Dominadas', 'Press militar'] },
            { day: 6, focus: 'Descanso', exercises: [] },
            { day: 7, focus: 'Descanso', exercises: [] }
        ];

        // Tab navigation
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.getElementById('tab-' + tabName).classList.add('active');
                this.classList.add('active');
            });
        });

        // Storage functions
        function loadData() {
            const saved = localStorage.getItem('productivityData');
            if (saved) {
                data = JSON.parse(saved);
                updateAllDisplays();
            }
        }

        function saveData() {
            localStorage.setItem('productivityData', JSON.stringify(data));
        }

        // Work activities
        document.getElementById('work-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                data.workActivities.push({
                    id: Date.now(),
                    text: this.value,
                    date: new Date().toLocaleString()
                });
                this.value = '';
                renderWorkActivities();
                saveData();
            }
        });

        function renderWorkActivities() {
            const list = document.getElementById('work-list');
            list.innerHTML = data.workActivities.map(activity => `
                <div class="list-item">
                    <div>
                        <p style="font-weight: 500;">${activity.text}</p>
                        <p style="font-size: 0.875rem; color: #6b7280;">${activity.date}</p>
                    </div>
                    <button onclick="deleteWorkActivity(${activity.id})" style="background: none; color: #ef4444;">‚ùå</button>
                </div>
            `).join('');
        }

        function deleteWorkActivity(id) {
            data.workActivities = data.workActivities.filter(a => a.id !== id);
            renderWorkActivities();
            saveData();
        }

        // Goals
        document.getElementById('goal-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                data.goals.push({
                    id: Date.now(),
                    text: this.value,
                    completed: false
                });
                this.value = '';
                renderGoals();
                saveData();
            }
        });

        function renderGoals() {
            const list = document.getElementById('goals-list');
            list.innerHTML = data.goals.map(goal => `
                <div class="list-item">
                    <span style="${goal.completed ? 'text-decoration: line-through; color: #6b7280;' : ''}">${goal.text}</span>
                    <div class="flex gap-1">
                        <button onclick="toggleGoal(${goal.id})" style="padding: 0.5rem; border-radius: 9999px; background: ${goal.completed ? '#10b981' : '#d1d5db'}; color: white;">‚úì</button>
                        <button onclick="deleteGoal(${goal.id})" class="btn-danger" style="border-radius: 9999px;">‚ùå</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleGoal(id) {
            const goal = data.goals.find(g => g.id === id);
            if (goal) goal.completed = !goal.completed;
            renderGoals();
            saveData();
        }

        function deleteGoal(id) {
            data.goals = data.goals.filter(g => g.id !== id);
            renderGoals();
            saveData();
        }

        // Tasks
        function addTask() {
            const taskInput = document.getElementById('task-input');
            const dateTime = document.getElementById('task-datetime');
            
            if (taskInput.value.trim() && dateTime.value) {
                data.tasks.push({
                    id: Date.now(),
                    text: taskInput.value,
                    dateTime: dateTime.value,
                    notified: false
                });
                taskInput.value = '';
                dateTime.value = '';
                renderTasks();
                saveData();
            }
        }

        function renderTasks() {
            const list = document.getElementById('tasks-list');
            list.innerHTML = data.tasks.map(task => `
                <div class="list-item" style="background: #fce7f3;">
                    <div>
                        <p style="font-weight: 500;">${task.text}</p>
                        <p style="font-size: 0.875rem; color: #6b7280;">üîî ${new Date(task.dateTime).toLocaleString()}</p>
                    </div>
                    <button onclick="deleteTask(${task.id})" style="background: none; color: #ef4444;">‚ùå</button>
                </div>
            `).join('');
        }

        function deleteTask(id) {
            data.tasks = data.tasks.filter(t => t.id !== id);
            renderTasks();
            saveData();
        }

        // Exercises
        function getCurrentDayRoutine() {
            const startDate = new Date('2025-01-01');
            const today = new Date();
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const dayIndex = diffDays % 7;
            return exerciseRoutine[dayIndex];
        }

        function renderExercises() {
            const routine = getCurrentDayRoutine();
            document.getElementById('today-routine').textContent = `Hoy: ${routine.focus}`;
            
            const list = document.getElementById('exercises-list');
            let html = routine.exercises.map(ex => {
                const exercise = data.exercises.find(e => e.name === ex);
                const checked = exercise ? exercise.completed : false;
                return `
                    <div class="list-item">
                        <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                            <input type="checkbox" ${checked ? 'checked' : ''} onchange="toggleExercise('${ex}')">
                            <span>${ex}</span>
                        </label>
                    </div>
                `;
            }).join('');

            html += data.customExercises.map(ex => `
                <div class="list-item" style="background: #fce7f3;">
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                        <input type="checkbox" ${ex.completed ? 'checked' : ''} onchange="toggleCustomExercise(${ex.id})">
                        <span>${ex.name}</span>
                    </label>
                    <button onclick="deleteCustomExercise(${ex.id})" style="background: none; color: #ef4444;">‚ùå</button>
                </div>
            `).join('');

            list.innerHTML = html;
        }

        function toggleExercise(name) {
            const exercise = data.exercises.find(e => e.name === name);
            if (exercise) {
                exercise.completed = !exercise.completed;
            } else {
                data.exercises.push({ name, completed: true });
            }
            saveData();
        }

        function toggleCustomExercise(id) {
            const exercise = data.customExercises.find(e => e.id === id);
            if (exercise) exercise.completed = !exercise.completed;
            renderExercises();
            saveData();
        }

        function deleteCustomExercise(id) {
            data.customExercises = data.customExercises.filter(e => e.id !== id);
            renderExercises();
            saveData();
        }

        document.getElementById('custom-exercise-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                data.customExercises.push({
                    id: Date.now(),
                    name: this.value,
                    completed: false
                });
                this.value = '';
                renderExercises();
                saveData();
            }
        });

        document.getElementById('height-input').addEventListener('input', function() {
            data.height = parseInt(this.value) || 170;
            saveData();
        });

        document.getElementById('weight-input').addEventListener('input', function() {
            data.weight = parseInt(this.value) || 70;
            saveData();
        });

        // Nutrition
        function updateNutritionGoals() {
            const caloriesGoal = parseInt(document.getElementById('calories-goal').value) || 2000;
            const proteinGoal = parseInt(document.getElementById('protein-goal').value) || 150;
            const carbsGoal = parseInt(document.getElementById('carbs-goal').value) || 200;
            const fatGoal = parseInt(document.getElementById('fat-goal').value) || 60;

            document.getElementById('goal-calories-display').textContent = caloriesGoal.toLocaleString();
            document.getElementById('goal-protein-display').textContent = proteinGoal;
            document.getElementById('goal-carbs-display').textContent = carbsGoal;
            document.getElementById('goal-fat-display').textContent = fatGoal;
            
            updateNutritionDisplay();
        }

        function calculateConsumedMacros() {
            return data.meals.reduce((acc, meal) => ({
                calories: acc.calories + meal.calories,
                protein: acc.protein + meal.protein,
                carbs: acc.carbs + meal.carbs,
                fat: acc.fat + meal.fat
            }), { calories: 0, protein: 0, carbs: 0, fat: 0 });
        }

        function updateNutritionDisplay() {
            const consumed = calculateConsumedMacros();
            const caloriesGoal = parseInt(document.getElementById('calories-goal').value) || 2000;

            document.getElementById('consumed-calories').textContent = consumed.calories;
            document.getElementById('consumed-protein').textContent = consumed.protein;
            document.getElementById('consumed-carbs').textContent = consumed.carbs;
            document.getElementById('consumed-fat').textContent = consumed.fat;
            document.getElementById('remaining-calories').textContent = Math.max(0, caloriesGoal - consumed.calories);
        }

        function addMeal() {
            const name = document.getElementById('food-name').value;
            const calories = parseInt(document.getElementById('food-calories').value) || 0;
            const protein = parseInt(document.getElementById('food-protein').value) || 0;
            const carbs = parseInt(document.getElementById('food-carbs').value) || 0;
            const fat = parseInt(document.getElementById('food-fat').value) || 0;

            if (name && calories) {
                data.meals.push({ id: Date.now(), name, calories, protein, carbs, fat });
                document.getElementById('food-name').value = '';
                document.getElementById('food-calories').value = '';
                document.getElementById('food-protein').value = '';
                document.getElementById('food-carbs').value = '';
                document.getElementById('food-fat').value = '';
                renderMeals();
                updateNutritionDisplay();
                saveData();
            }
        }

        function renderMeals() {
            const list = document.getElementById('meals-list');
            list.innerHTML = data.meals.map(meal => `
                <div class="list-item" style="background: #f9fafb;">
                    <div>
                        <p style="font-weight: 500;">${meal.name}</p>
                        <p style="font-size: 0.875rem; color: #6b7280;">${meal.calories} kcal | P:${meal.protein}g C:${meal.carbs}g G:${meal.fat}g</p>
                    </div>
                    <button onclick="deleteMeal(${meal.id})" style="background: none; color: #ef4444;">‚ùå</button>
                </div>
            `).join('');
        }

        function deleteMeal(id) {
            data.meals = data.meals.filter(m => m.id !== id);
            renderMeals();
            updateNutritionDisplay();
            saveData();
        }

        document.getElementById('calories-goal').addEventListener('input', updateNutritionGoals);
        document.getElementById('protein-goal').addEventListener('input', updateNutritionGoals);
        document.getElementById('carbs-goal').addEventListener('input', updateNutritionGoals);
        document.getElementById('fat-goal').addEventListener('input', updateNutritionGoals);

        // Sleep
        function evaluateSleep() {
            if (data.sleepLogs.length === 0) {
                return { quality: 'Sin datos', advice: 'Registra tus horas de sue√±o', color: '#f3f4f6' };
            }
            const avgSleep = data.sleepLogs.reduce((a, b) => a + b.hours, 0) / data.sleepLogs.length;
            if (avgSleep >= 7 && avgSleep <= 9) {
                return { quality: 'Bien', advice: 'Mant√©n esta rutina', color: '#d1fae5' };
            }
            if (avgSleep < 7) {
                return { quality: 'Mal', advice: 'Intenta dormir al menos 7 horas', color: '#fee2e2' };
            }
            return { quality: 'Regular', advice: 'Evita dormir m√°s de 9 horas', color: '#fef3c7' };
        }

        function updateSleepEvaluation() {
            const eval = evaluateSleep();
            const evalDiv = document.getElementById('sleep-evaluation');
            evalDiv.style.background = eval.color;
            
            let avgText = '';
            if (data.sleepLogs.length > 0) {
                const avg = (data.sleepLogs.reduce((a, b) => a + b.hours, 0) / data.sleepLogs.length).toFixed(1);
                avgText = `<p style="font-size: 0.875rem; color: #4b5563; margin-top: 0.5rem;">Promedio: ${avg} horas</p>`;
            }
            
            evalDiv.innerHTML = `
                <h3>Calidad del Sue√±o: ${eval.quality}</h3>
                <p>${eval.advice}</p>
                ${avgText}
            `;
        }

        function addSleepLog() {
            const hours = parseFloat(document.getElementById('sleep-hours').value);
            if (hours > 0) {
                data.sleepLogs.push({
                    id: Date.now(),
                    hours,
                    date: new Date().toLocaleDateString()
                });
                document.getElementById('sleep-hours').value = '';
                renderSleepLogs();
                updateSleepEvaluation();
                saveData();
            }
        }

        function renderSleepLogs() {
            const list = document.getElementById('sleep-logs-list');
            list.innerHTML = data.sleepLogs.map(log => `
                <div class="list-item">
                    <div>
                        <p style="font-weight: 500;">${log.hours} horas</p>
                        <p style="font-size: 0.875rem; color: #6b7280;">${log.date}</p>
                    </div>
                    <button onclick="deleteSleepLog(${log.id})" style="background: none; color: #ef4444;">‚ùå</button>
                </div>
            `).join('');
        }

        function deleteSleepLog(id) {
            data.sleepLogs = data.sleepLogs.filter(l => l.id !== id);
            renderSleepLogs();
            updateSleepEvaluation();
            saveData();
        }

        // Savings
        function updateSavingsDisplay() {
            const goal = parseInt(document.getElementById('savings-goal-input').value) || 10000;
            const current = data.currentSavings;
            const remaining = Math.max(0, goal - current);
            const percentage = Math.min(100, Math.round((current / goal) * 100));

            document.getElementById('savings-goal-display').textContent = goal.toLocaleString();
            document.getElementById('current-savings').textContent = current.toLocaleString();
            document.getElementById('remaining-savings').textContent = remaining.toLocaleString();
            document.getElementById('savings-progress-bar').style.width = percentage + '%';
            document.getElementById('savings-percentage').textContent = percentage;
        }

        function addSavings() {
            const amount = parseInt(document.getElementById('savings-amount').value);
            if (amount > 0) {
                data.currentSavings += amount;
                document.getElementById('savings-amount').value = '';
                updateSavingsDisplay();
                saveData();
            }
        }

        document.getElementById('savings-goal-input').addEventListener('input', function() {
            updateSavingsDisplay();
            saveData();
        });

        // NoFap, Pages, Pomodoro
        function incrementNoFap() {
            data.noFapDays++;
            document.getElementById('nofap-days').textContent = data.noFapDays;
            saveData();
        }

        function resetNoFap() {
            data.noFapDays = 0;
            document.getElementById('nofap-days').textContent = data.noFapDays;
            saveData();
        }

        function incrementPages() {
            data.pagesRead++;
            document.getElementById('pages-read').textContent = data.pagesRead;
            saveData();
        }

        function resetPages() {
            data.pagesRead = 0;
            document.getElementById('pages-read').textContent = data.pagesRead;
            saveData();
        }

        let pomodoroInterval = null;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        function togglePomodoro() {
            data.pomodoroRunning = !data.pomodoroRunning;
            const btn = document.getElementById('pomodoro-toggle');
            
            if (data.pomodoroRunning) {
                btn.textContent = 'Pausar';
                btn.style.background = '#ef4444';
                startPomodoro();
            } else {
                btn.textContent = 'Iniciar';
                btn.style.background = '#db2777';
                stopPomodoro();
            }
            saveData();
        }

        function startPomodoro() {
            pomodoroInterval = setInterval(() => {
                if (data.pomodoroTime > 0) {
                    data.pomodoroTime--;
                    document.getElementById('pomodoro-timer').textContent = formatTime(data.pomodoroTime);
                    saveData();
                } else {
                    stopPomodoro();
                    data.pomodoroRunning = false;
                    const btn = document.getElementById('pomodoro-toggle');
                    btn.textContent = 'Iniciar';
                    btn.style.background = '#db2777';
                    
                    if (Notification.permission === 'granted') {
                        new Notification('Pomodoro Completado', {
                            body: 'Toma un descanso de 5 minutos'
                        });
                    } else {
                        alert('¬°Pomodoro completado! Toma un descanso de 5 minutos.');
                    }
                    
                    data.pomodoroTime = 1500;
                    document.getElementById('pomodoro-timer').textContent = formatTime(data.pomodoroTime);
                    saveData();
                }
            }, 1000);
        }

        function stopPomodoro() {
            if (pomodoroInterval) {
                clearInterval(pomodoroInterval);
                pomodoroInterval = null;
            }
        }

        function resetPomodoro() {
            stopPomodoro();
            data.pomodoroTime = 1500;
            data.pomodoroRunning = false;
            document.getElementById('pomodoro-timer').textContent = formatTime(data.pomodoroTime);
            const btn = document.getElementById('pomodoro-toggle');
            btn.textContent = 'Iniciar';
            btn.style.background = '#db2777';
            saveData();
        }

        function generateReport(type) {
            const now = new Date();
            const reportDate = now.toLocaleDateString();
            
            // Calculate statistics
            const consumed = calculateConsumedMacros();
            const caloriesGoal = parseInt(document.getElementById('calories-goal').value) || 2000;
            const sleepEval = evaluateSleep();
            const savingsGoal = parseInt(document.getElementById('savings-goal-input').value) || 10000;
            const savingsPercentage = Math.min(100, Math.round((data.currentSavings / savingsGoal) * 100));
            
            // Calculate completed exercises
            const totalExercises = data.exercises.length + data.customExercises.length;
            const completedExercises = data.exercises.filter(e => e.completed).length + 
                                      data.customExercises.filter(e => e.completed).length;
            
            // Create report HTML
            const reportHTML = `
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte ${type} - ${reportDate}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }
        h1 {
            color: #9333ea;
            text-align: center;
            border-bottom: 3px solid #c084fc;
            padding-bottom: 10px;
        }
        h2 {
            color: #7c3aed;
            margin-top: 30px;
            border-left: 4px solid #c084fc;
            padding-left: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9d5ff;
        }
        .stat-title {
            font-weight: bold;
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #9333ea;
        }
        .progress-bar {
            background: #e5e7eb;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #c084fc, #9333ea);
            transition: width 0.3s;
        }
        .section {
            background: #fafafa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .pareto-analysis {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #fbbf24;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f3e8ff;
            color: #7c3aed;
            font-weight: bold;
        }
        .footer {
            text-align: center;
            color: #6b7280;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e9d5ff;
        }
        @media print {
            body {
                padding: 10px;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>üìä Reporte ${type.charAt(0).toUpperCase() + type.slice(1)}</h1>
    <p style="text-align: center; color: #6b7280;">Generado el ${reportDate}</p>
    
    <h2>üìà Resumen General</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-title">Actividades Laborales</div>
            <div class="stat-value">${data.workActivities.length}</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">H√°bitos Completados</div>
            <div class="stat-value">${data.goals.filter(g => g.completed).length}/${data.goals.length}</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Ejercicios Realizados</div>
            <div class="stat-value">${completedExercises}/${totalExercises}</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Calor√≠as Consumidas</div>
            <div class="stat-value">${consumed.calories}</div>
        </div>
    </div>

    <h2>üí™ Ejercicio y Salud</h2>
    <div class="section">
        <p><strong>Altura:</strong> ${data.height} cm</p>
        <p><strong>Peso:</strong> ${data.weight} kg</p>
        <p><strong>IMC:</strong> ${(data.weight / ((data.height/100) ** 2)).toFixed(1)}</p>
        <p><strong>Ejercicios completados:</strong> ${completedExercises} de ${totalExercises}</p>
        ${completedExercises > 0 ? `
        <div class="progress-bar">
            <div class="progress-fill" style="width: ${(completedExercises/totalExercises*100)}%"></div>
        </div>
        ` : ''}
    </div>

    <h2>üçΩÔ∏è Nutrici√≥n</h2>
    <div class="section">
        <p><strong>Meta diaria:</strong> ${caloriesGoal} kcal</p>
        <p><strong>Consumido:</strong> ${consumed.calories} kcal</p>
        <p><strong>Restante:</strong> ${Math.max(0, caloriesGoal - consumed.calories)} kcal</p>
        <div style="margin-top: 15px;">
            <p><strong>Macros:</strong></p>
            <ul>
                <li>Prote√≠na: ${consumed.protein}g</li>
                <li>Carbohidratos: ${consumed.carbs}g</li>
                <li>Grasas: ${consumed.fat}g</li>
            </ul>
        </div>
        ${data.meals.length > 0 ? `
        <table>
            <tr>
                <th>Comida</th>
                <th>Calor√≠as</th>
                <th>Prote√≠na</th>
            </tr>
            ${data.meals.slice(0, 10).map(meal => `
            <tr>
                <td>${meal.name}</td>
                <td>${meal.calories} kcal</td>
                <td>${meal.protein}g</td>
            </tr>
            `).join('')}
        </table>
        ` : '<p>No hay comidas registradas</p>'}
    </div>

    <h2>üåô Sue√±o</h2>
    <div class="section">
        <p><strong>Calidad:</strong> ${sleepEval.quality}</p>
        <p><strong>Recomendaci√≥n:</strong> ${sleepEval.advice}</p>
        ${data.sleepLogs.length > 0 ? `
        <p><strong>Promedio:</strong> ${(data.sleepLogs.reduce((a, b) => a + b.hours, 0) / data.sleepLogs.length).toFixed(1)} horas</p>
        ` : '<p>No hay registros de sue√±o</p>'}
    </div>

    <h2>üí∞ Ahorro</h2>
    <div class="section">
        <p><strong>Meta:</strong> ${savingsGoal.toLocaleString()}</p>
        <p><strong>Ahorrado:</strong> ${data.currentSavings.toLocaleString()}</p>
        <p><strong>Progreso:</strong> ${savingsPercentage}%</p>
        <div class="progress-bar">
            <div class="progress-fill" style="width: ${savingsPercentage}%; background: linear-gradient(to right, #10b981, #059669);"></div>
        </div>
    </div>

    <h2>üìö Otros H√°bitos</h2>
    <div class="section">
        <p><strong>NoFap:</strong> ${data.noFapDays} d√≠as</p>
        <p><strong>P√°ginas le√≠das:</strong> ${data.pagesRead} p√°ginas</p>
    </div>

    <div class="pareto-analysis">
        <h2 style="margin-top: 0;">‚ö° An√°lisis Pareto 80/20</h2>
        <p><strong>Principio de Pareto aplicado a tu productividad:</strong></p>
        <ul>
            <li><strong>El 80% de tus resultados viene del 20% de tus esfuerzos</strong></li>
            <li>Has completado ${data.goals.filter(g => g.completed).length} de ${data.goals.length} h√°bitos (${data.goals.length > 0 ? Math.round(data.goals.filter(g => g.completed).length / data.goals.length * 100) : 0}%)</li>
            <li>Focus en ejercicio: ${completedExercises > 0 ? '‚úÖ Mant√©n tu rutina de ejercicio' : '‚ö†Ô∏è Aumenta tu actividad f√≠sica'}</li>
            <li>Nutrici√≥n: ${consumed.calories > 0 ? '‚úÖ Est√°s rastreando tu alimentaci√≥n' : '‚ö†Ô∏è Comienza a registrar tus comidas'}</li>
            <li>Sue√±o: ${data.sleepLogs.length > 0 ? '‚úÖ Monitoreando calidad de sue√±o' : '‚ö†Ô∏è Registra tus horas de sue√±o'}</li>
        </ul>
        <p style="margin-top: 15px;"><strong>Recomendaci√≥n:</strong> Enf√≥cate en los h√°bitos que m√°s impacto tienen en tu bienestar general. Prioriza el sue√±o, ejercicio y nutrici√≥n balanceada.</p>
    </div>

    <div class="footer">
        <p><strong>Mi Vida Productiva</strong></p>
        <p>Reporte generado el ${now.toLocaleString()}</p>
        <button class="no-print" onclick="window.print()" style="margin-top: 10px; padding: 10px 20px; background: #9333ea; color: white; border: none; border-radius: 5px; cursor: pointer;">üñ®Ô∏è Imprimir / Guardar PDF</button>
    </div>
</body>
</html>`;

            // Create and download the report
            const blob = new Blob([reportHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte_${type}_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Reporte descargado. Abre el archivo HTML y usa "Imprimir" para guardarlo como PDF.');
        }

        function updateAllDisplays() {
            renderWorkActivities();
            renderGoals();
            renderTasks();
            renderExercises();
            renderMeals();
            updateNutritionGoals();
            updateNutritionDisplay();
            renderSleepLogs();
            updateSleepEvaluation();
            updateSavingsDisplay();
            
            document.getElementById('nofap-days').textContent = data.noFapDays;
            document.getElementById('pages-read').textContent = data.pagesRead;
            document.getElementById('pomodoro-timer').textContent = formatTime(data.pomodoroTime);
            document.getElementById('height-input').value = data.height;
            document.getElementById('weight-input').value = data.weight;
        }

        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // PWA Installation
        const manifestData = {
            "name": "Mi Vida Productiva",
            "short_name": "Productiva",
            "description": "Gestiona tu vida: trabajo, metas, ejercicio, nutrici√≥n y m√°s",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#c084fc",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23c084fc;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23f0abfc;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23grad)'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white' font-family='Arial'%3Eüìä%3C/text%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23c084fc;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23f0abfc;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23grad)'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white' font-family='Arial'%3Eüìä%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'mi-vida-productiva-v1';
                
                self.addEventListener('install', (event) => {
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    event.waitUntil(
                        caches.keys().then((cacheNames) => {
                            return Promise.all(
                                cacheNames.map((cacheName) => {
                                    if (cacheName !== CACHE_NAME) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                    return self.clients.claim();
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `;
            
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(swBlob);
            
            navigator.serviceWorker.register(swURL).then((registration) => {
                console.log('Service Worker registrado con √©xito');
            }).catch((error) => {
                console.log('Error al registrar Service Worker:', error);
            });
        }

        loadData();
        updateAllDisplays();
    </script>
</body>
</html>